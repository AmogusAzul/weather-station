# Weather Station Project Development

## 1. Introduction
This project aims to develop a weather station system capable of collecting environmental data, processing it, and transmitting it to a central server for analysis. Throughout the development process, technical solutions and improvements have been implemented to ensure a robust and efficient system.

## 2. Project Description
The system consists of two main components:

### Weather Stations
The stations are equipped with sensors to measure climatic variables such as temperature, humidity, and pressure. They use a board integrating an Arduino Mega chip and an ESP8266, detailed in [this link](https://www.luisllamas.es/arduino-mega-esp8266-en-un-unico-dispositivo/). This hardware combines the processing power of the Arduino Mega with the WiFi connectivity of the ESP8266, enabling efficient data transmission to the server.

The repository includes simplified versions of the code for connecting the Arduino to the server, which are located in the `station/example/` folder. These versions are useful for initial testing and understanding the fundamentals of the communication system.

### Central Server
The server is implemented in Go, using a **worker** architecture with a **job queue** to process tasks concurrently. This structure allows multiple stations to communicate simultaneously without impacting performance.

The server is Docker-based and uses a private **Network** to securely connect with a MySQL database. This design ensures efficient management of the data received and processed.

### Database
The database is structured into three main tables: `station`, `measurement`, and `entry`. These tables are created automatically by a bash script executing SQL code located in `server/docker/mysql/tables-init.sh`. The structure is as follows:

- **Table `station`**:
  - Contains information about the registered stations.
  - Columns:
    - `station_id`: Unique identifier, auto-incremented.
    - `station_owner`: Name of the station owner (required).
    - `latitude`: Station's latitude, validated to be between -90 and 90.
    - `longitude`: Station's longitude, validated to be between -180 and 180.
    - `password_hash`: Hash of the station's password, required for authentication.

- **Table `measurement`**:
  - Contains specific measurements sent by the stations.
  - Columns:
    - `measurement_id`: Unique identifier, auto-incremented.
    - `random_num`: Random number generated by the stations during initial tests.

- **Table `entry`**:
  - Records individual entries sent by the stations, including location, time, and associated measurements.
  - Columns:
    - `entry_id`: Unique identifier, auto-incremented.
    - `station_id`: Links to the station that sent the entry.
    - `latitude`: Entry latitude, validated to be between -90 and 90.
    - `longitude`: Entry longitude, validated to be between -180 and 180.
    - `measurement_id`: Links to the recorded measurement.
    - `entry_time`: Timestamp indicating when the entry was received.
  - Relationships:
    - `station_id` is a foreign key referencing the `station` table.
    - `measurement_id` is a foreign key referencing the `measurement` table.
  - **Reason for duplicating station coordinates**: This duplication ensures historical data remains unaffected if a station relocates. Older entries retain their original coordinates, avoiding inconsistencies in stored data.

## 3. Development Process

### Project Start
The development began with two main focuses:
1. **Server Configuration**: Built using [Go](https://go.dev/learn/) and [Docker](https://docs.docker.com/get-started/), structured to handle weather data efficiently. A private **Network** was used to connect the server and the [MySQL](https://dev.mysql.com/doc/) database.
2. **Weather Stations**: A board with an Arduino Mega and ESP8266 chip was selected as the base for communication and data collection.

### Initial Development
To validate the initial infrastructure, the [Packet Sender](https://packetsender.com/) tool was used to send simulated data to the server. This allowed testing the reception, interpretation, and storage of data under controlled conditions. Once the server proved stable, the stations began generating random numbers as simulated data for additional testing.

### Refinement and Expansion
The project evolved with new features:
1. **Code Structuring**: The server was organized into independent modules for better clarity and scalability.
2. **Data Validation**: Instead of encryption, strict validation of data transmitted by the stations was prioritized to ensure integrity.
3. **Local Interactions**: Stations started using SD modules to store network configurations and critical data.

## 4. Final Project Structure

### Project Tree
```
├── server
│ ├── data-server
│ ├── docker
│ ├── safety
│ ├── codec
│ ├── tcp
│ └── db-handle
├── station
│ ├── code
│ │ ├── arduino
│ │ ├── esp8266
│ │ └── common
│ ├── example
│ │ ├── arduino-mega-station.ino
│ │ └── esp8266-station.ino
│ ├── libraries
│ └── sd-content
```

## 5. How to Use

### Prerequisites
1. Install [Git](https://git-scm.com/).
2. Install [Docker](https://docs.docker.com/get-docker/).
3. Install [Arduino IDE](https://www.arduino.cc/en/software).
4. Clone the repository:
```
git clone https://github.com/AmogusAzul/weather-station
cd weather-station
```

5. Set up the server using Docker:
```
cd server/docker docker-compose up
```
6. Load and upload the code for your station:
- Open `station/code/arduino/arduino.ino` or `station/code/esp8266/esp8266.ino` in Arduino IDE.
- Adjust the network and token settings.
- Upload the code to the respective board.

## 6. Next Steps

### Server Expansion
- **HTTP Support**: A system for visualizing graphs and tables directly in a browser will be integrated.
- **Data Download**: Users will be able to download reports in formats such as CSV or PNG.

### Weather Station Development
1. **Sensor Selection**: Choosing specific sensors to measure temperature, humidity, pressure, and other environmental variables.
2. **Case Design**: Creating a durable structure to protect the stations' electronic components in harsh conditions.
3. **Firmware Optimization**: Improving code performance to handle real-time data efficiently.

### Testing and Validation
- Stress tests will be conducted to ensure the system can handle multiple stations connected simultaneously.
- A detailed user guide will be developed to facilitate system implementation and use.

## 7. Conclusion
The weather station project has made significant progress, implementing a robust technical infrastructure and overcoming design and functionality challenges. The next steps will ensure an efficient system for collecting and analyzing weather data, providing accessible and valuable visualization tools for users.

### Repository
The code for this project is available in this [github repository](https://github.com/AmogusAzul/weather-station)